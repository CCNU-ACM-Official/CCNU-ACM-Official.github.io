---
title: 乘法逆元和快速幂
titleTemplate: 数学
---

### 最大公约数

定义：$gcd(x,y)$是$x,y$是最大公约数。

#### 更相减损术

引理一：$gcd(x,y)=gcd(x-y,y)$

证明：设$x,y$的最大公约数是$g$，$x=k_1*g,y=k_2*g$

$x-y=(k_1-k_2)*g$（默认$x>y$）。

那么$k_1-k_2$和$k_2$一定是互质的。

设$k_1-k_2$和$k_2$的最大公约数是$g_2$，那么$k_1$和$k_2$的最大公约数也是$g_2$，而$k_1$和$k_2$互质，所以$x-y$和$y$也互质。

综上，得到更相减损术：$gcd(x,y)=gcd(x-y,y)$，一直递归到某个数字为$0$为止，另一个数字就是最小公倍数。

```cpp
int gcd(int a,int b)
{
	if(a<b) swap(a,b);
    if(!b) return a;
    return gcd(b,a-b);
}
```

#### 辗转相除法

你都做减法了为啥不直接做除法

$gcd(x,y)=gcd(y,x\%y)$

```cpp
int gcd(int a,int b)
{
	if(!b) return a;
    return gcd(b,a%b);
}
```

### 同余

随时取模定理：
$$
(a+b)\ mod\ p=((a\ mod\ p)+(b\ mod\ p))\ mod\ p\\
(a-b)\ mod\ p=((a\ mod\ p)-(b\ mod\ p))\ mod\ p\\
(a*b)\ mod\ p=((a\ mod\ p)*(b\ mod\ p))\ mod\ p\\
$$

注意没有除法，因为除法运算在取模意义下不封闭，举例子：

$5/3=?$ 答案不是整数。
$$
ac\equiv bc\ (mod\ m)\Rightarrow a\equiv b\ (mod\ \frac{m}{gcd(c,m)})\\
a\equiv b\ (mod\ m)\Rightarrow a\equiv b\ (mod\ d)\ (d|m)\\
a\equiv b\ (mod\ m)\Rightarrow a\equiv b\ (mod\ k*m)\ (k\in Z^+)
$$


不知道什么定理：
$$
a\equiv b\ (mod\ m)\Leftrightarrow gcd(a,m)=gcd(b,m)
$$
用下面的更相减损术很好证明。

### 性质

一个数$x$模任意数字后，$x$必减少至少一半。

证明：

当$p\leq \frac{x}{2}$时
$$
x\ mod\ p<p\leq \frac{x}{2}
$$
当$p>\frac{x}{2}$时

### 乘法逆元

在一般的实数域上，减法和加法互为逆元，乘法和除法互为逆元。

具体来说就是$a*p÷p=a$。

逆元定义就是可以消除特定影响的操作。

比如乘法逆元定义可以看作是消除乘法影响的操作。

在实数域乘法逆元就是除以乘数本身。

你可以说你走路来实验室的逆元是骑电车回宿舍（你让骑室友回宿舍都算逆元）。

然而我们在计算机中，一般研究离散的领域，比如在模意义下。

例如，我们在模$7$意义下，$3*5=15$，$15$模$7$等于$1$。然而$1$不能再除以$5$了，因为模意义下没有$\frac{1}{5}$这种东西。

那我们想把$1$再重新变回$3$怎么办呢，有个办法是$*3$（废话，我还可以$+2$呢。）

其实$*3$真的是$*5$的逆元，我们考虑任意一个数字$a$，它在模$7$意义下，先乘$5$，再乘$3$，得到$a*5*3=a*15=a*1$。就等于是消除了影响，我们可以可以将$3$视作模$7$意义下的$\frac{1}{5}$的存在

所以可以推到，在模意义下，乘法的逆元一般是再乘以一个数，让两个数连乘的结果为$1$，从而做到消除第一个乘数的影响。

#### 费马小定理

$$
a^{p-1}\equiv 1\ (mod\ p)\ (p是质数)\\
a*a^{p-2}\equiv 1\ (mod\ p)(p是质数)
$$

所以得到$a$的逆元是$a^{p-2}$（$a$不为$p$的倍数）

证明：

集合$\{a,2a,3a,……,(p-1)a\}=\{1,2,3,……,p-1\}$

只要证明$\{a,2a,3a,……,(p-1)a\}$互不相同。

证明：

如果$k_1a\equiv k_2a\ (mod\ p)$，那么

$(k_1-k_2)a\equiv 0\ (mod\ p)$，那么$k_1=k_2$，矛盾。

所以$\{a,2a,3a,……,(p-1)a\}$互不相同。

所以
$$
\prod_{i=1}^{p-1}i*a\equiv \prod_{i=1}^{p-1}i\ (mod\ p)\\
a^{p-1}*\prod_{i=1}^{p-1}i\equiv \prod_{i=1}^{p-1}i\ (mod\ p)\\
a^{p-1}\equiv 1\ (mod\ p)
$$
（*）或者另一种证明：二项式定理+数学归纳

显然有$1^p=1$

如果$a^p=a$

那么
$$
(a+1)^p=\sum_{k=0}^p\dbinom{p}{k}a^k\\
$$
除了$k=0$和$k=p$那两项，其它项都是$p$的倍数，所以都被模没了

所以
$$
(a+1)^p\equiv a^p+1(\ mod\ p)
$$


将$a^p=a$代入，得到$(a+1)^p\equiv a+1$。

所以$a^{p-1}\equiv 1$

费马小定理只适用于$p$是质数的情况，不过对大部分情况都够用了（如果你不研究算法，这辈子都够用了）。

### 快速幂

简单的快速幂不细说了，翻前面课件。

快速幂适用于一切有结合律的运算。

比如说用倍增的加法可以实现两个数相乘（）

这个其实是有意义的，比如你的模数是$10^{10}$级别的，那么两个数字直接相乘就会溢出$long\ long$，这时候你可以用倍增的加法实现乘法。

还有其他运算，比如矩阵乘法比较有意义。

考虑斐波那契数列，它的递推式是$f_n=f_{n-1}+f_{n-2}$，其中边界是$f_1,f_2$。

如果我们设置一个$1*2$的数列，它的里面是$[f_{i-1},f_i]$，我们现在想要得到$[f_i,f_{i+1}]$，那么我们需要第一个位置获得一个$f_i$，第二个位置获得$f_{i-1}+f_i$。

[//]: # (![image-20230710073622772]&#40;C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230710073622772.png&#41;)



可以构造一个转移矩阵
$$
T=\begin{bmatrix}
0 & 1\\
1 & 1\\
\end{bmatrix}
$$
转移就可以做到
$$
[f_{i-1},f_i]\begin{bmatrix}
0 & 1\\
1 & 1\\
\end{bmatrix}
=[f_i,f_{i-1}+f_i]=[f_i,f_{i+1}]
$$
那么我们一开始有$[f_1,f_2]$，我们想得到$f_n$，只要求$[f_1,f_2]*T^{n-1}$

然而矩阵乘法有结合律，所以我们可以先用快速幂算出$T^{n-1}$是多少，这部分复杂度是$O(k^3logn)$，其中$k$是矩阵的阶（一般是方阵）。然后再用初始条件乘以转移矩阵，得到最终结果。

```cpp
struct matrix
{
    int a[110][110];
    matrix(){memset(a,0,sizeof(a));}//初始化
    matrix operator * (const matrix &t) const//重载乘号为矩阵乘法
    {
        matrix ret;
        for(int i=0;i<n;++i)
        {
            for(int j=0;j<n;++j)
            {
                for(int k=0;k<n;++k)
                {
                    ret.a[i][j]+=a[i][k]*t.a[k][j];
                }
            }
        }
        return ret;
    }
}T;
matrix fast(matrix x,int k)
{
    matrix ret;
    for(int i=0;i<n;++i) ret.a[i][i]=1;//单位矩阵
    while(k)
    {
        if(k&1) ret=ret*x;
        x=x*x;
        k>>=1;
    }
    return ret;
}
```

### 练习题

[P1226 【模板】快速幂 | 取余运算  ](https://www.luogu.com.cn/problem/P1226)

[P3390 【模板】矩阵快速幂  ](https://www.luogu.com.cn/problem/P3390)

[P3811 【模板】乘法逆元  ](https://www.luogu.com.cn/problem/P3811?contestId=117141)

[P1939 【模板】矩阵加速（数列）  ](https://www.luogu.com.cn/problem/P1939)

[P1349 广义斐波那契数列  ](https://www.luogu.com.cn/problem/P1349)

